(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,n){e.exports=n(27)},23:function(e,t,n){},24:function(e,t,n){},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(13),o=n.n(i),s=(n(22),n(23),n(15)),c=n(2),l=n(3),u=n(10),m=n(7),d=n(9),h=n(29),f=n(30),g=n(31),p=n(32),v=(n(24),function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("video",{autoPlay:!0,muted:!0,id:this.props.idAttr,className:"video"})}}]),t}(r.a.Component)),w=(n(25),function(){function e(){Object(c.a)(this,e),this.ws=null,this.user=null,this.onMessageCallbacks=[],this.onRegisterCb=function(){}}return Object(l.a)(e,[{key:"setUser",value:function(e){this.user=e}},{key:"onMessage",value:function(e){this.onMessageCallbacks.push(e)}},{key:"onRegister",value:function(e){this.onRegisterCb=e}},{key:"connect",value:function(){var e=this;this.ws=new WebSocket("wss://r12aimxa21.execute-api.eu-west-2.amazonaws.com/Prod"),this.ws.onmessage=function(t){var n=JSON.parse(t.data);switch(n.action){case"registerSuccess":e.onRegisterCb(!0,n.payload);break;case"communticate":e.onMessageCallbacks.forEach(function(e){return e(n.payload)});break;default:e.onRegisterCb(!1)}}}},{key:"send",value:function(e){if(!this.ws)throw new Error("Connection is lost or has not been established yet");this.user&&(e.from=this.user),this.ws.send(JSON.stringify({message:"sendmessage",data:e}))}},{key:"register",value:function(e){this.send({action:"register",payload:e})}},{key:"communicate",value:function(e,t){this.send({action:"communicate",payload:{to:e,message:t}})}}]),e}()),C=(n(26),function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"message"},r.a.createElement("span",{className:"message__title"},this.props.item.from),r.a.createElement("div",null,this.props.item.message))}}]),t}(r.a.Component)),b=function(){function e(t){var n=this;Object(c.a)(this,e),this.serverConnection=t,this.peerUserName=null,this.localVideo=null,this.localStream=null,this.remoteVideo=null,this.peerConnection=null,this.uuid=null,this.peerConnectionConfig={iceServers:[{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.l.google.com:19302"}]},this.gotMessageFromServer=function(e){n.peerConnection||n.start();var t,a=n.peerConnection;try{t=JSON.parse(e.message)}catch(i){return}if(t.uuid&&t.uuid!==n.uuid)if(n.peerUserName=e.from,console.log(t),t.sdp){var r=t.sdp;a.setRemoteDescription(new RTCSessionDescription(t.sdp)).then(function(){"offer"===r.type&&a.createAnswer().then(n.createdDescription).catch(n.errorHandler)}).catch(n.errorHandler)}else t.ice&&a.addIceCandidate(new RTCIceCandidate(t.ice)).catch(n.errorHandler)},this.gotIceCandidate=function(e){null!=e.candidate&&n.serverConnection.communicate(n.peerUserName,JSON.stringify({ice:e.candidate,uuid:n.uuid}))},this.createdDescription=function(e){var t=n.peerConnection;if(!t)throw new Error("No peerConnection");t.setLocalDescription(e).then(function(){n.serverConnection.communicate(n.peerUserName,JSON.stringify({sdp:t.localDescription,uuid:n.uuid}))}).catch(n.errorHandler)},this.gotRemoteStream=function(e){if(!n.remoteVideo)throw new Error("No remoteVideo element");n.remoteVideo.srcObject=e.streams[0]},this.getUserMediaSuccess=function(e){if(!n.localVideo)throw new Error("No localVideo element");n.localStream=e,n.localVideo.srcObject=e},this.errorHandler=function(e){console.log(e)}}return Object(l.a)(e,[{key:"init",value:function(e,t){this.uuid=this.createUUID(),this.localVideo=document.getElementById(e),this.remoteVideo=document.getElementById(t),this.serverConnection.onMessage(this.gotMessageFromServer);navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(this.getUserMediaSuccess).catch(this.errorHandler):alert("Your browser does not support getUserMedia API")}},{key:"start",value:function(e){var t=void 0!==e;if(!this.localStream)throw new Error("No localStream");var n=new RTCPeerConnection(this.peerConnectionConfig);n.onicecandidate=this.gotIceCandidate,n.ontrack=this.gotRemoteStream;var a=!0,r=!1,i=void 0;try{for(var o,s=this.localStream.getTracks()[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=o.value;n.addTrack(c,this.localStream)}}catch(l){r=!0,i=l}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}this.peerConnection=n,t&&(this.peerUserName=e,n.createOffer().then(this.createdDescription).catch(this.errorHandler))}},{key:"createUUID",value:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}]),e}(),y=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).ws=new w,n.webRtc=new b(n.ws),n.toNameRef=r.a.createRef(),n.toMessageRef=r.a.createRef(),n.handleOnStartCallClick=function(){var e=n.toNameRef.current&&n.toNameRef.current.value;e&&n.webRtc.start(e)},n.handleOnSendMessageClick=function(){var e=n.toNameRef.current&&n.toNameRef.current.value,t=n.toMessageRef.current&&n.toMessageRef.current.value;e&&t&&n.ws.communicate(e,t)},n.state={name:null,messages:[]},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(h.a,null,r.a.createElement(f.a,null,r.a.createElement(g.a,null,r.a.createElement(v,{idAttr:"localVideo"})),r.a.createElement(g.a,null,r.a.createElement(v,{idAttr:"remoteVideo"}))),r.a.createElement(f.a,null,r.a.createElement(g.a,null,r.a.createElement(p.a,{onClick:function(){return e.handleOnRegisterClick()},variant:"primary"},"Register")),r.a.createElement(g.a,null,r.a.createElement(p.a,{onClick:this.handleOnStartCallClick,variant:"success"},"Call"),r.a.createElement(p.a,{variant:"danger"},"Abort call")),r.a.createElement(g.a,null,"Logged in as: ",this.state.name)),r.a.createElement(f.a,null,r.a.createElement(g.a,null,r.a.createElement("input",{ref:this.toNameRef,placeholder:"Message to...",type:"text"}),r.a.createElement("textarea",{ref:this.toMessageRef,placeholder:"Message body..."})),r.a.createElement(g.a,null,r.a.createElement(p.a,{onClick:this.handleOnSendMessageClick,variant:"secondary"},"Send message")),r.a.createElement(g.a,null,"Messages: ",this.state.messages.map(function(e,t){return r.a.createElement("div",{key:t},r.a.createElement(C,{item:e}),r.a.createElement("hr",null))}))))}},{key:"componentDidMount",value:function(){var e=this;this.ws.connect(),this.ws.onRegister(function(t,n){e.setState({name:t&&n?n:null})}),this.ws.onMessage(function(t){e.setState({messages:[].concat(Object(s.a)(e.state.messages),[t])})}),this.initWebRTC()}},{key:"handleOnRegisterClick",value:function(){var e=prompt("Enter a name");e&&this.ws.register(e)}},{key:"initWebRTC",value:function(){this.webRtc.init("localVideo","remoteVideo")}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[16,1,2]]]);
//# sourceMappingURL=main.961fdeb2.chunk.js.map